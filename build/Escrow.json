{
  "contractName": "Escrow",
  "constructorInputs": [
    {
      "name": "payer",
      "type": "pubkey"
    },
    {
      "name": "payee",
      "type": "pubkey"
    },
    {
      "name": "escrowAgent",
      "type": "pubkey"
    },
    {
      "name": "releaseUnlockTime",
      "type": "int"
    },
    {
      "name": "minerFeeSats",
      "type": "int"
    }
  ],
  "abi": [
    {
      "name": "releaseByPayer",
      "inputs": [
        {
          "name": "payerSig",
          "type": "sig"
        },
        {
          "name": "recipient",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "releaseByPayee",
      "inputs": [
        {
          "name": "payeeSig",
          "type": "sig"
        },
        {
          "name": "recipient",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "releaseByAgent",
      "inputs": [
        {
          "name": "agentSig",
          "type": "sig"
        },
        {
          "name": "recipient",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "autoRelease",
      "inputs": [
        {
          "name": "recipient",
          "type": "pubkey"
        }
      ]
    },
    {
      "name": "receiveFunds",
      "inputs": []
    }
  ],
  "bytecode": "OP_5 OP_PICK OP_0 OP_NUMEQUAL OP_IF OP_6 OP_ROLL OP_SWAP OP_CHECKSIGVERIFY OP_INPUTINDEX OP_UTXOVALUE OP_DUP OP_5 OP_PICK OP_GREATERTHAN OP_VERIFY OP_4 OP_ROLL OP_SUB OP_TXOUTPUTCOUNT OP_1 OP_GREATERTHANOREQUAL OP_VERIFY OP_TXOUTPUTCOUNT OP_1 OP_NUMEQUAL OP_IF OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_ELSE OP_TXOUTPUTCOUNT OP_2 OP_NUMEQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_ACTIVEBYTECODE OP_EQUALVERIFY OP_1 OP_OUTPUTVALUE OP_0 OP_OUTPUTVALUE OP_ADD OP_OVER OP_NUMEQUALVERIFY OP_ENDIF OP_5 OP_PICK OP_6 OP_ROLL OP_EQUALVERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_5 OP_PICK OP_1 OP_NUMEQUAL OP_IF OP_6 OP_ROLL OP_ROT OP_CHECKSIGVERIFY OP_INPUTINDEX OP_UTXOVALUE OP_DUP OP_5 OP_PICK OP_GREATERTHAN OP_VERIFY OP_4 OP_ROLL OP_SUB OP_TXOUTPUTCOUNT OP_1 OP_GREATERTHANOREQUAL OP_VERIFY OP_TXOUTPUTCOUNT OP_1 OP_NUMEQUAL OP_IF OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_ELSE OP_TXOUTPUTCOUNT OP_2 OP_NUMEQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_ACTIVEBYTECODE OP_EQUALVERIFY OP_1 OP_OUTPUTVALUE OP_0 OP_OUTPUTVALUE OP_ADD OP_OVER OP_NUMEQUALVERIFY OP_ENDIF OP_5 OP_PICK OP_6 OP_ROLL OP_EQUALVERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_5 OP_PICK OP_2 OP_NUMEQUAL OP_IF OP_6 OP_ROLL OP_3 OP_ROLL OP_CHECKSIGVERIFY OP_INPUTINDEX OP_UTXOVALUE OP_DUP OP_5 OP_PICK OP_GREATERTHAN OP_VERIFY OP_4 OP_ROLL OP_SUB OP_TXOUTPUTCOUNT OP_1 OP_GREATERTHANOREQUAL OP_VERIFY OP_TXOUTPUTCOUNT OP_1 OP_NUMEQUAL OP_IF OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_ELSE OP_TXOUTPUTCOUNT OP_2 OP_NUMEQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_ACTIVEBYTECODE OP_EQUALVERIFY OP_1 OP_OUTPUTVALUE OP_0 OP_OUTPUTVALUE OP_ADD OP_OVER OP_NUMEQUALVERIFY OP_ENDIF OP_5 OP_PICK OP_6 OP_ROLL OP_EQUALVERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_5 OP_PICK OP_3 OP_NUMEQUAL OP_IF OP_TXLOCKTIME OP_4 OP_ROLL OP_GREATERTHANOREQUAL OP_VERIFY OP_INPUTINDEX OP_UTXOVALUE OP_DUP OP_5 OP_PICK OP_GREATERTHAN OP_VERIFY OP_4 OP_ROLL OP_SUB OP_TXOUTPUTCOUNT OP_1 OP_GREATERTHANOREQUAL OP_VERIFY OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_TXOUTPUTCOUNT OP_1 OP_NUMEQUAL OP_IF OP_0 OP_OUTPUTVALUE OP_OVER OP_NUMEQUALVERIFY OP_ELSE OP_TXOUTPUTCOUNT OP_2 OP_NUMEQUALVERIFY OP_1 OP_OUTPUTBYTECODE OP_ACTIVEBYTECODE OP_EQUALVERIFY OP_1 OP_OUTPUTVALUE OP_0 OP_OUTPUTVALUE OP_ADD OP_OVER OP_NUMEQUALVERIFY OP_ENDIF OP_5 OP_PICK OP_6 OP_ROLL OP_EQUALVERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ELSE OP_5 OP_ROLL OP_4 OP_NUMEQUALVERIFY OP_1 OP_VERIFY OP_2DROP OP_2DROP OP_DROP OP_1 OP_ENDIF OP_ENDIF OP_ENDIF OP_ENDIF",
  "source": "pragma cashscript ^0.12.0;\n\n/*\n  Escrow.cash\n  - Constructor:\n      pubkey payer,\n      pubkey payee,\n      pubkey escrowAgent,        // neutral arbitrator\n      int releaseUnlockTime,     // unix time after which auto-release to payee allowed\n      int minerFeeSats\n  - Functions:\n      releaseByPayer(sig payerSig, pubkey recipient)        // payer approves release\n      releaseByPayee(sig payeeSig, pubkey recipient)        // payee claims\n      releaseByAgent(sig agentSig, pubkey recipient)        // escrow agent resolves\n      autoRelease(pubkey recipient)                         // allowed after locktime (no sig)\n      receiveFunds()\n  - Behavior:\n      Sum(outputs) == inputVal - minerFeeSats\n      output[0] == recipient amount (usually full distributable; backend controls partial splits)\n*/\n\ncontract Escrow(pubkey payer, pubkey payee, pubkey escrowAgent, int releaseUnlockTime, int minerFeeSats) {\n\n  function releaseByPayer(sig payerSig, pubkey recipient) {\n    require(checkSig(payerSig, payer));\n    int inputVal = tx.inputs[this.activeInputIndex].value;\n    require(inputVal > minerFeeSats);\n    int distributable = inputVal - minerFeeSats;\n\n    // Either single output equal distributable, or recipient + change back to contract\n    require(tx.outputs.length >= 1);\n    if (tx.outputs.length == 1) {\n      require(tx.outputs[0].value == distributable);\n    } else {\n      require(tx.outputs.length == 2);\n      require(tx.outputs[1].lockingBytecode == this.activeBytecode);\n      require(tx.outputs[1].value + tx.outputs[0].value == distributable);\n    }\n    require(recipient == recipient);\n  }\n\n  function releaseByPayee(sig payeeSig, pubkey recipient) {\n    require(checkSig(payeeSig, payee));\n    int inputVal = tx.inputs[this.activeInputIndex].value;\n    require(inputVal > minerFeeSats);\n    int distributable = inputVal - minerFeeSats;\n\n    require(tx.outputs.length >= 1);\n    if (tx.outputs.length == 1) {\n      require(tx.outputs[0].value == distributable);\n    } else {\n      require(tx.outputs.length == 2);\n      require(tx.outputs[1].lockingBytecode == this.activeBytecode);\n      require(tx.outputs[1].value + tx.outputs[0].value == distributable);\n    }\n    require(recipient == recipient);\n  }\n\n  function releaseByAgent(sig agentSig, pubkey recipient) {\n    require(checkSig(agentSig, escrowAgent));\n    int inputVal = tx.inputs[this.activeInputIndex].value;\n    require(inputVal > minerFeeSats);\n    int distributable = inputVal - minerFeeSats;\n\n    require(tx.outputs.length >= 1);\n    if (tx.outputs.length == 1) {\n      require(tx.outputs[0].value == distributable);\n    } else {\n      require(tx.outputs.length == 2);\n      require(tx.outputs[1].lockingBytecode == this.activeBytecode);\n      require(tx.outputs[1].value + tx.outputs[0].value == distributable);\n    }\n    require(recipient == recipient);\n  }\n\n  // Auto-release to payee (no signature) after unlock time\n  function autoRelease(pubkey recipient) {\n    require(tx.locktime >= releaseUnlockTime);\n\n    int inputVal = tx.inputs[this.activeInputIndex].value;\n    require(inputVal > minerFeeSats);\n    int distributable = inputVal - minerFeeSats;\n\n    require(tx.outputs.length >= 1);\n    require(tx.outputs[0].value == distributable);\n\n      // Ensure outputs sum to distributable (single output or recipient+change)\n      if (tx.outputs.length == 1) {\n        require(tx.outputs[0].value == distributable);\n      } else {\n        require(tx.outputs.length == 2);\n        require(tx.outputs[1].lockingBytecode == this.activeBytecode);\n        require(tx.outputs[1].value + tx.outputs[0].value == distributable);\n      }\n      require(recipient == recipient);\n  }\n\n  function receiveFunds() {\n    // accept deposits into escrow\n    require(true);\n  }\n}\n",
  "debug": {
    "bytecode": "5579009c63567a7cadc0c6765579a069547a94c451a269c4519c6300cc789d67c4529d51cdc18851cc00cc93789d685579567a886d6d7551675579519c63567a7badc0c6765579a069547a94c451a269c4519c6300cc789d67c4529d51cdc18851cc00cc93789d685579567a886d6d7551675579529c63567a537aadc0c6765579a069547a94c451a269c4519c6300cc789d67c4529d51cdc18851cc00cc93789d685579567a886d6d7551675579539c63c5547aa269c0c6765579a069547a94c451a26900cc789dc4519c6300cc789d67c4529d51cdc18851cc00cc93789d685579567a886d6d755167557a549d51696d6d755168686868",
    "sourceMap": "24:2:40:3;;;;;25:21:25:29;;:31::36;:4::39:1;26:29:26:50:0;:19::57:1;27:12:27:20:0;:23::35;;:12:::1;:4::37;28:35:28:47:0;;:24:::1;31:12:31:29:0;:33::34;:12:::1;:4::36;32:8:32:25:0;:29::30;:8:::1;:32:34:5:0;33:25:33:26;:14::33:1;:37::50:0;:6::52:1;34:11:38:5:0;35:14:35:31;:35::36;:6::38:1;36:25:36:26:0;:14::43:1;:47::66:0;:6::68:1;37:25:37:26:0;:14::33:1;:47::48:0;:36::55:1;:14;:59::72:0;:6::74:1;34:11:38:5;39:12:39:21:0;;:25::34;;:4::36:1;24:2:40:3;;;;;42::57::0;;;;;43:21:43:29;;:31::36;:4::39:1;44:29:44:50:0;:19::57:1;45:12:45:20:0;:23::35;;:12:::1;:4::37;46:35:46:47:0;;:24:::1;48:12:48:29:0;:33::34;:12:::1;:4::36;49:8:49:25:0;:29::30;:8:::1;:32:51:5:0;50:25:50:26;:14::33:1;:37::50:0;:6::52:1;51:11:55:5:0;52:14:52:31;:35::36;:6::38:1;53:25:53:26:0;:14::43:1;:47::66:0;:6::68:1;54:25:54:26:0;:14::33:1;:47::48:0;:36::55:1;:14;:59::72:0;:6::74:1;51:11:55:5;56:12:56:21:0;;:25::34;;:4::36:1;42:2:57:3;;;;;59::74::0;;;;;60:21:60:29;;:31::42;;:4::45:1;61:29:61:50:0;:19::57:1;62:12:62:20:0;:23::35;;:12:::1;:4::37;63:35:63:47:0;;:24:::1;65:12:65:29:0;:33::34;:12:::1;:4::36;66:8:66:25:0;:29::30;:8:::1;:32:68:5:0;67:25:67:26;:14::33:1;:37::50:0;:6::52:1;68:11:72:5:0;69:14:69:31;:35::36;:6::38:1;70:25:70:26:0;:14::43:1;:47::66:0;:6::68:1;71:25:71:26:0;:14::33:1;:47::48:0;:36::55:1;:14;:59::72:0;:6::74:1;68:11:72:5;73:12:73:21:0;;:25::34;;:4::36:1;59:2:74:3;;;;;77::96::0;;;;;78:12:78:23;:27::44;;:12:::1;:4::46;80:29:80:50:0;:19::57:1;81:12:81:20:0;:23::35;;:12:::1;:4::37;82:35:82:47:0;;:24:::1;84:12:84:29:0;:33::34;:12:::1;:4::36;85:23:85:24:0;:12::31:1;:35::48:0;:4::50:1;88:10:88:27:0;:31::32;:10:::1;:34:90:7:0;89:27:89:28;:16::35:1;:39::52:0;:8::54:1;90:13:94:7:0;91:16:91:33;:37::38;:8::40:1;92:27:92:28:0;:16::45:1;:49::68:0;:8::70:1;93:27:93:28:0;:16::35:1;:49::50:0;:38::57:1;:16;:61::74:0;:8::76:1;90:13:94:7;95:14:95:23:0;;:27::36;;:6::38:1;77:2:96:3;;;;;98::101::0;;;;100:12:100:16;:4::18:1;98:2:101:3;;;;22:0:102:1;;;",
    "logs": [],
    "requires": [
      {
        "ip": 13,
        "line": 25
      },
      {
        "ip": 20,
        "line": 27
      },
      {
        "ip": 27,
        "line": 31
      },
      {
        "ip": 35,
        "line": 33
      },
      {
        "ip": 39,
        "line": 35
      },
      {
        "ip": 43,
        "line": 36
      },
      {
        "ip": 50,
        "line": 37
      },
      {
        "ip": 56,
        "line": 39
      },
      {
        "ip": 70,
        "line": 43
      },
      {
        "ip": 77,
        "line": 45
      },
      {
        "ip": 84,
        "line": 48
      },
      {
        "ip": 92,
        "line": 50
      },
      {
        "ip": 96,
        "line": 52
      },
      {
        "ip": 100,
        "line": 53
      },
      {
        "ip": 107,
        "line": 54
      },
      {
        "ip": 113,
        "line": 56
      },
      {
        "ip": 128,
        "line": 60
      },
      {
        "ip": 135,
        "line": 62
      },
      {
        "ip": 142,
        "line": 65
      },
      {
        "ip": 150,
        "line": 67
      },
      {
        "ip": 154,
        "line": 69
      },
      {
        "ip": 158,
        "line": 70
      },
      {
        "ip": 165,
        "line": 71
      },
      {
        "ip": 171,
        "line": 73
      },
      {
        "ip": 186,
        "line": 78
      },
      {
        "ip": 193,
        "line": 81
      },
      {
        "ip": 200,
        "line": 84
      },
      {
        "ip": 204,
        "line": 85
      },
      {
        "ip": 212,
        "line": 89
      },
      {
        "ip": 216,
        "line": 91
      },
      {
        "ip": 220,
        "line": 92
      },
      {
        "ip": 227,
        "line": 93
      },
      {
        "ip": 233,
        "line": 95
      },
      {
        "ip": 244,
        "line": 100
      }
    ]
  },
  "compiler": {
    "name": "cashc",
    "version": "0.12.0"
  },
  "updatedAt": "2025-11-22T11:03:29.770Z"
}